{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/fatma/Desktop/Fraud_Detection_Syst/src/lib/mongodb.ts"],"sourcesContent":[" import mongoose from \"mongoose\";\r\n\r\n const MONGODB_URI = process.env.MONGODB_URI || \"mongodb+srv://ProjetNextJs:P12QKE5OtxQR8SupXZQ9C@fdsdb.dffagbq.mongodb.net/FDS\";\r\n if (!MONGODB_URI) {\r\n    throw new Error(\"❌ Please add your MongoDB URI to .env.local\");\r\n }\r\n let isConnected = false;\r\n export async function dbConnect() {\r\n    if (isConnected) return;\r\n    try {\r\n        await mongoose.connect(MONGODB_URI);\r\n        isConnected = true;\r\n        console.log(\"✅MongoDB connected\");\r\n        console.log(`MongoDB URI: ${MONGODB_URI}`);\r\n    } catch (error) {\r\n        console.error(\"❌ MongoDB connection error\", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAC;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAC/C;;AAGA,IAAI,cAAc;AACX,eAAe;IACnB,IAAI,aAAa;IACjB,IAAI;QACA,MAAM,oHAAQ,CAAC,OAAO,CAAC;QACvB,cAAc;QACd,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,CAAC,aAAa,EAAE,aAAa;IAC7C,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,MAAM;IACV;AACJ"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/fatma/Desktop/Fraud_Detection_Syst/src/Models/User.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst UserSchema = new mongoose.Schema({\r\n  name: { type: String, required: true },\r\n  email: { type: String, required: true, unique: true },\r\n  mobile: { type: String },\r\n  passwordHash: { type: String, required: true },\r\n  role: {\r\n    type: String,\r\n    enum: [\"CLIENT\", \"TECHNICIEN\", \"ANALYSTE\", \"ADMIN\", \"analystefinanciere\"],\r\n    required: true\r\n  },\r\n  isAuthenticated: { type: Boolean, default: false },\r\n  createdAt: { type: Date, default: Date.now }\r\n});\r\n\r\nexport default mongoose.models.User || mongoose.model(\"User\", UserSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,aAAa,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACrC,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,OAAO;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACpD,QAAQ;QAAE,MAAM;IAAO;IACvB,cAAc;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC7C,MAAM;QACJ,MAAM;QACN,MAAM;YAAC;YAAU;YAAc;YAAY;YAAS;SAAqB;QACzE,UAAU;IACZ;IACA,iBAAiB;QAAE,MAAM;QAAS,SAAS;IAAM;IACjD,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC7C;uCAEe,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAC,QAAQ"}},
    {"offset": {"line": 144, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/fatma/Desktop/Fraud_Detection_Syst/src/app/api/auth/login/route.ts"],"sourcesContent":["import { dbConnect } from \"@/lib/mongodb\";\r\nimport User from \"@/Models/User\";\r\nimport bcrypt from \"bcryptjs\";\r\nimport jwt from \"jsonwebtoken\";\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    await dbConnect();\r\n\r\n    const { email, password } = await req.json();\r\n\r\n    if (!email || !password) {\r\n      return new Response(JSON.stringify({ error: \"Missing required fields\" }), {\r\n        status: 400,\r\n      });\r\n    }\r\n\r\n    const user = await User.findOne({ email });\r\n    if (!user) {\r\n      return new Response(JSON.stringify({ error: \"Invalid credentials\" }), {\r\n        status: 401,\r\n      });\r\n    }\r\n\r\n    // FIX: use passwordHash instead of password\r\n    const isMatch = await bcrypt.compare(password, user.passwordHash);\r\n    if (!isMatch) {\r\n      return new Response(JSON.stringify({ error: \"Invalid credentials\" }), {\r\n        status: 401,\r\n      });\r\n    }\r\n\r\n    const token = jwt.sign(\r\n      { userId: user._id, role: user.role },\r\n      process.env.JWT_SECRET as string,\r\n      { expiresIn: \"1d\" }\r\n    );\r\n\r\n    return new Response(\r\n      JSON.stringify({\r\n        message: \"Login successful\",\r\n        token,\r\n        user: {\r\n          id: user._id,\r\n          name: user.name,\r\n          email: user.email,\r\n          role: user.role,\r\n        },\r\n      }),\r\n      { status: 200 }\r\n    );\r\n\r\n  } catch (error) {\r\n    console.error(\"Login error:\", error);\r\n    return new Response(\r\n      JSON.stringify({\r\n        error: \"Something went wrong\",\r\n        details: error instanceof Error ? error.message : \"Unknown error\",\r\n      }),\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,IAAA,oIAAS;QAEf,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAE1C,IAAI,CAAC,SAAS,CAAC,UAAU;YACvB,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAA0B,IAAI;gBACxE,QAAQ;YACV;QACF;QAEA,MAAM,OAAO,MAAM,kIAAI,CAAC,OAAO,CAAC;YAAE;QAAM;QACxC,IAAI,CAAC,MAAM;YACT,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAsB,IAAI;gBACpE,QAAQ;YACV;QACF;QAEA,4CAA4C;QAC5C,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAAC,UAAU,KAAK,YAAY;QAChE,IAAI,CAAC,SAAS;YACZ,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAsB,IAAI;gBACpE,QAAQ;YACV;QACF;QAEA,MAAM,QAAQ,kJAAG,CAAC,IAAI,CACpB;YAAE,QAAQ,KAAK,GAAG;YAAE,MAAM,KAAK,IAAI;QAAC,GACpC,QAAQ,GAAG,CAAC,UAAU,EACtB;YAAE,WAAW;QAAK;QAGpB,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;YACb,SAAS;YACT;YACA,MAAM;gBACJ,IAAI,KAAK,GAAG;gBACZ,MAAM,KAAK,IAAI;gBACf,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,IAAI;YACjB;QACF,IACA;YAAE,QAAQ;QAAI;IAGlB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;YACb,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,IACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}