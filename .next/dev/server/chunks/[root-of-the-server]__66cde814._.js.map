{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/medse/Desktop/Fraud_Detect/fraud_detection/src/lib/mongodb.ts"],"sourcesContent":[" import mongoose from \"mongoose\";\r\n\r\n const MONGODB_URI = process.env.MONGODB_URI || \"mongodb://127.0.0.1:27017/FDS\";\r\n if (!MONGODB_URI) {\r\n    throw new Error(\"❌ Please add your MongoDB URI to .env.local\");\r\n }\r\n let isConnected = false;\r\n export async function dbConnect() {\r\n    if (isConnected) return;\r\n    try {\r\n        await mongoose.connect(MONGODB_URI);\r\n        isConnected = true;\r\n        console.log(\"✅MongoDB connected\");\r\n    } catch (error) {\r\n        console.error(\"❌ MongoDB connection error\", error);\r\n        throw error;\r\n    }\r\n}"],"names":[],"mappings":";;;;AAAC;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAC/C;;AAGA,IAAI,cAAc;AACX,eAAe;IACnB,IAAI,aAAa;IACjB,IAAI;QACA,MAAM,oHAAQ,CAAC,OAAO,CAAC;QACvB,cAAc;QACd,QAAQ,GAAG,CAAC;IAChB,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,MAAM;IACV;AACJ"}},
    {"offset": {"line": 77, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/medse/Desktop/Fraud_Detect/fraud_detection/src/Models/User.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\nimport bcrypt from 'bcrypt';\r\n\r\nconst UserSchema = new mongoose.Schema({\r\n  name: { type: String, required: true },\r\n  email: { type: String, required: true, unique: true },\r\n  password: { type: String, required: true },\r\n  role: { type: String, enum: ['client','technicien','analystefinanciere','admin'], default: 'client' },\r\n  createdAt: { type: Date, default: Date.now }\r\n});\r\n\r\n// Hash password before save\r\nUserSchema.pre('save', async function(next){\r\n  if (!this.isModified('password')) return next();\r\n  const salt = await bcrypt.genSalt(10);\r\n  this.password = await bcrypt.hash(this.password, salt);\r\n  next();\r\n});\r\n\r\n// UserSchema.methods.comparePassword = function(candidate){\r\n//   return bcrypt.compare(candidate, this.password);\r\n// };\r\n\r\nconst User = mongoose.model('User', UserSchema);\r\nexport default User;\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,aAAa,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACrC,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,OAAO;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACpD,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAS;YAAa;YAAqB;SAAQ;QAAE,SAAS;IAAS;IACpG,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC7C;AAEA,4BAA4B;AAC5B,WAAW,GAAG,CAAC,QAAQ,eAAe,IAAI;IACxC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,OAAO;IACzC,MAAM,OAAO,MAAM,gHAAM,CAAC,OAAO,CAAC;IAClC,IAAI,CAAC,QAAQ,GAAG,MAAM,gHAAM,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;IACjD;AACF;AAEA,4DAA4D;AAC5D,qDAAqD;AACrD,KAAK;AAEL,MAAM,OAAO,oHAAQ,CAAC,KAAK,CAAC,QAAQ;uCACrB"}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/medse/Desktop/Fraud_Detect/fraud_detection/src/app/api/auth/register/route.ts"],"sourcesContent":["import { dbConnect } from \"@/lib/mongodb\";\r\nimport User from \"@/Models/User\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    await dbConnect();\r\n    \r\n    // CORRECTION : Recevoir 'password' au lieu de 'passwordHash'\r\n    const { name, email, mobile, password, role }: \r\n      { name: string;\r\n        email: string;\r\n        mobile?: string;\r\n        password: string;\r\n        role: string } = \r\n      await req.json();\r\n\r\n    // Validation des champs requis\r\n    if (!name || !email || !password || !role) {\r\n      return new Response(JSON.stringify({ error: \"Missing required fields\" }), {\r\n        status: 400 \r\n      });\r\n    }\r\n\r\n    const existingUser = await User.findOne({ email });\r\n    if (existingUser) {\r\n      return new Response(JSON.stringify({ error: \"User already exists\" }), {\r\n        status: 400 \r\n      });\r\n    }\r\n\r\n    // CORRECTION : Hasher 'password' au lieu de 'passwordHash'\r\n    const passwordHash = await bcrypt.hash(password, 10);\r\n    \r\n    const newUser = new User({ \r\n      name, \r\n      email, \r\n      mobile: mobile || \"\", \r\n      passwordHash, // Utiliser le mot de passe hashé\r\n      role, \r\n      isAuthenticated: false // Par défaut false\r\n    });\r\n    \r\n    await newUser.save();\r\n    \r\n    return new Response(JSON.stringify({ message: \"User registered successfully\" }), { \r\n      status: 201 \r\n    });\r\n    \r\n  } catch (error) {\r\n    console.error(\"Registration error:\", error);\r\n    return new Response(JSON.stringify({ \r\n      error: \"Something went wrong\",\r\n      details: error instanceof Error ? error.message : \"Unknown error\"\r\n    }), { \r\n      status: 500 \r\n    });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,IAAA,oIAAS;QAEf,6DAA6D;QAC7D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,GAM3C,MAAM,IAAI,IAAI;QAEhB,+BAA+B;QAC/B,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,YAAY,CAAC,MAAM;YACzC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAA0B,IAAI;gBACxE,QAAQ;YACV;QACF;QAEA,MAAM,eAAe,MAAM,kIAAI,CAAC,OAAO,CAAC;YAAE;QAAM;QAChD,IAAI,cAAc;YAChB,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;gBAAE,OAAO;YAAsB,IAAI;gBACpE,QAAQ;YACV;QACF;QAEA,2DAA2D;QAC3D,MAAM,eAAe,MAAM,8IAAM,CAAC,IAAI,CAAC,UAAU;QAEjD,MAAM,UAAU,IAAI,kIAAI,CAAC;YACvB;YACA;YACA,QAAQ,UAAU;YAClB;YACA;YACA,iBAAiB,MAAM,mBAAmB;QAC5C;QAEA,MAAM,QAAQ,IAAI;QAElB,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YAAE,SAAS;QAA+B,IAAI;YAC/E,QAAQ;QACV;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC;YACjC,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,IAAI;YACF,QAAQ;QACV;IACF;AACF"}}]
}